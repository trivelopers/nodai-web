#!/bin/bash

# NodAI Deployment Script

echo "ğŸš€ NodAI Deployment with Docker & Traefik"
echo "========================================="

# Check if Docker is running
if ! docker info > /dev/null 2>&1; then
    echo "âŒ Docker is not running. Please start Docker first."
    exit 1
fi

# Create Traefik network if it doesn't exist
if ! docker network ls | grep -q traefik; then
    echo "ğŸ“¡ Creating Traefik network..."
    docker network create traefik
fi

# Check if environment variables are set
if [ -z "$GEMINI_API_KEY" ]; then
    echo "âš ï¸  Warning: GEMINI_API_KEY environment variable is not set"
    echo "   Make sure to set it before running the application"
fi

# Build and start services
echo "ğŸ”¨ Building and starting services..."
docker compose up -d --build

echo ""
echo "âœ… Deployment complete!"
echo ""
echo "ğŸŒ Your application will be available at:"
echo "   â€¢ https://nodai.app (production)"
echo "   â€¢ https://traefik.nodai.app (Traefik dashboard)"
echo ""
echo "ğŸ“‹ Useful commands:"
echo "   â€¢ docker-compose logs -f nodai-web    # View app logs"
echo "   â€¢ docker-compose logs -f traefik      # View Traefik logs"
echo "   â€¢ docker-compose down                 # Stop services"
echo "   â€¢ docker-compose up -d --build        # Rebuild and restart"
echo ""
echo "ğŸ”’ SSL certificates will be automatically generated by Let's Encrypt"
echo "   First request might take a few minutes while certificates are issued"
